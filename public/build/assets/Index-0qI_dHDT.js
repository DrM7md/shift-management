import{j as e,r as o,u as C,H as $,d as S}from"./app-Cwhk-y-Q.js";import{M as J,T as D,C as K,a as d}from"./MainLayout-DG_h4u18.js";import{f as Q}from"./dateFormat-TyM5950g.js";import{b as U,B as n,T as g,C as V,d as X,P as Y,I}from"./Schedule-DiIcUQZb.js";import{T as c,F as _,I as z,S as T}from"./TextField-B5TSfn_l.js";import{B as u}from"./Button-bpof-n8Y.js";import{T as Z,a as N,b as ee,c as b,d as t,e as se}from"./TableRow-UwqfMSIv.js";import{C as m}from"./Chip-DMEJQ661.js";import{E as te,D as ae}from"./Edit-2gKizbpp.js";import{D as L,a as W,b as k,c as E}from"./DialogTitle-dKimb_-J.js";import{S as le}from"./Snackbar-DrVTsFTV.js";import{A as re}from"./Alert-BPajDfgF.js";const ne=U(e.jsx("path",{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25z"})),ie={مجدول:"info",أتم:"success",غائب:"error",بديل:"warning"};function ve({shifts:f,employees:F,filters:w}){const[O,x]=o.useState(!1),[B,h]=o.useState(!1),[p,P]=o.useState(null),[i,l]=o.useState({open:!1,message:"",severity:"success"}),[j,H]=o.useState(w),r=C({start_date:new Date().toISOString().split("T")[0],days:30}),a=C({status:"مجدول",substitute_id:null,notes:""}),v=(s,y)=>{H({...j,[s]:y}),S.get("/schedule",{...j,[s]:y},{preserveState:!0})},M=s=>{s.preventDefault(),r.post("/schedule/generate",{onSuccess:()=>{x(!1),l({open:!0,message:"تم توليد الجدول بنجاح",severity:"success"})},onError:()=>{l({open:!0,message:"حدث خطأ أثناء توليد الجدول",severity:"error"})}})},A=s=>{P(s),a.setData({status:s.status,substitute_id:s.substitute_id,notes:s.notes||""}),h(!0)},G=s=>{s.preventDefault(),p&&a.put(`/schedule/${p.id}`,{onSuccess:()=>{h(!1),l({open:!0,message:"تم تحديث المناوبة بنجاح",severity:"success"})},onError:()=>{l({open:!0,message:"حدث خطأ أثناء التحديث",severity:"error"})}})},q=s=>{confirm("هل أنت متأكد من حذف هذه المناوبة؟")&&S.delete(`/schedule/${s.id}`,{onSuccess:()=>{l({open:!0,message:"تم حذف المناوبة بنجاح",severity:"success"})}})},R=s=>s==="السبت"||s==="الجمعة"?{bgcolor:"primary.main",color:"white"}:{};return e.jsxs(J,{title:"جدول المناوبات",children:[e.jsx($,{title:"جدول المناوبات"}),e.jsxs(n,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(c,{type:"date",label:"من تاريخ",value:j.start_date,onChange:s=>v("start_date",s.target.value),size:"small",InputLabelProps:{shrink:!0}}),e.jsx(g,{color:"text.secondary",children:"إلى"}),e.jsx(c,{type:"date",label:"إلى تاريخ",value:j.end_date,onChange:s=>v("end_date",s.target.value),size:"small",InputLabelProps:{shrink:!0}})]}),e.jsx(u,{variant:"contained",startIcon:e.jsx(ne,{}),onClick:()=>x(!0),children:"توليد جدول"})]}),e.jsx(V,{children:e.jsx(X,{children:e.jsx(Z,{component:Y,elevation:0,children:e.jsxs(N,{children:[e.jsx(ee,{children:e.jsxs(b,{children:[e.jsx(t,{children:"التاريخ"}),e.jsx(t,{children:"اليوم"}),e.jsx(t,{children:"الموظف"}),e.jsx(t,{children:"الحالة"}),e.jsx(t,{children:"البديل"}),e.jsx(t,{children:"يوم إضافي"}),e.jsx(t,{children:"الإجراءات"})]})}),e.jsxs(se,{children:[f.map(s=>e.jsxs(b,{hover:!0,children:[e.jsx(t,{children:Q(s.shift_date)}),e.jsx(t,{children:e.jsx(m,{label:s.day_name,size:"small",sx:R(s.day_name)})}),e.jsx(t,{children:e.jsx(g,{fontWeight:500,children:s.employee?.name})}),e.jsx(t,{children:e.jsx(m,{label:s.status,color:ie[s.status],size:"small"})}),e.jsx(t,{children:s.substitute?.name||"-"}),e.jsx(t,{children:s.has_extra_day?e.jsx(m,{label:"نعم",color:"success",size:"small",variant:"outlined"}):e.jsx(m,{label:"لا",size:"small",variant:"outlined"})}),e.jsx(t,{children:e.jsxs(n,{sx:{display:"flex",gap:.5},children:[e.jsx(D,{title:"تعديل",children:e.jsx(I,{size:"small",color:"primary",onClick:()=>A(s),children:e.jsx(te,{fontSize:"small"})})}),e.jsx(D,{title:"حذف",children:e.jsx(I,{size:"small",color:"error",onClick:()=>q(s),children:e.jsx(ae,{fontSize:"small"})})})]})})]},s.id)),f.length===0&&e.jsx(b,{children:e.jsx(t,{colSpan:7,align:"center",children:e.jsxs(n,{sx:{py:4},children:[e.jsx(K,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(g,{color:"text.secondary",children:"لا توجد مناوبات في هذه الفترة"})]})})})]})]})})})}),e.jsx(L,{open:O,onClose:()=>x(!1),maxWidth:"sm",fullWidth:!0,children:e.jsxs("form",{onSubmit:M,children:[e.jsx(W,{children:"توليد جدول المناوبات"}),e.jsx(k,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[e.jsx(c,{type:"date",label:"تاريخ البداية",value:r.data.start_date,onChange:s=>r.setData("start_date",s.target.value),fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}}),e.jsx(c,{type:"number",label:"عدد الأيام",value:r.data.days,onChange:s=>r.setData("days",parseInt(s.target.value)),fullWidth:!0,required:!0,inputProps:{min:1,max:365}})]})}),e.jsxs(E,{children:[e.jsx(u,{onClick:()=>x(!1),children:"إلغاء"}),e.jsx(u,{type:"submit",variant:"contained",disabled:r.processing,children:"توليد"})]})]})}),e.jsx(L,{open:B,onClose:()=>h(!1),maxWidth:"sm",fullWidth:!0,children:e.jsxs("form",{onSubmit:G,children:[e.jsx(W,{children:"تحديث حالة المناوبة"}),e.jsx(k,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[e.jsxs(_,{fullWidth:!0,children:[e.jsx(z,{children:"الحالة"}),e.jsxs(T,{value:a.data.status,label:"الحالة",onChange:s=>a.setData("status",s.target.value),children:[e.jsx(d,{value:"مجدول",children:"مجدول"}),e.jsx(d,{value:"أتم",children:"أتم المناوبة"}),e.jsx(d,{value:"غائب",children:"غائب"}),e.jsx(d,{value:"بديل",children:"تم التبديل"})]})]}),a.data.status==="بديل"&&e.jsxs(_,{fullWidth:!0,children:[e.jsx(z,{children:"البديل"}),e.jsx(T,{value:a.data.substitute_id||"",label:"البديل",onChange:s=>a.setData("substitute_id",s.target.value),children:F.filter(s=>s.id!==p?.employee_id&&s.status==="متاح").map(s=>e.jsx(d,{value:s.id,children:s.name},s.id))})]}),e.jsx(c,{label:"ملاحظات",value:a.data.notes,onChange:s=>a.setData("notes",s.target.value),fullWidth:!0,multiline:!0,rows:3})]})}),e.jsxs(E,{children:[e.jsx(u,{onClick:()=>h(!1),children:"إلغاء"}),e.jsx(u,{type:"submit",variant:"contained",disabled:a.processing,children:"حفظ"})]})]})}),e.jsx(le,{open:i.open,autoHideDuration:4e3,onClose:()=>l({...i,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsx(re,{severity:i.severity,onClose:()=>l({...i,open:!1}),children:i.message})})]})}export{ve as default};
