import{j as e,r as x,u as _,H as G,d as v}from"./app-Cwhk-y-Q.js";import{M as J,T as W,c as K,a as l}from"./MainLayout-DG_h4u18.js";import{f as k}from"./dateFormat-TyM5950g.js";import{b as S,B as i,T as g,C as N,d as Q,P as U,I as z}from"./Schedule-DiIcUQZb.js";import{B as o}from"./Button-bpof-n8Y.js";import{T as X,a as h}from"./Tabs-Bq9LOEjY.js";import{C as b}from"./Chip-DMEJQ661.js";import{T as Y,a as Z,b as ee,c as y,d as t,e as se}from"./TableRow-UwqfMSIv.js";import{D as w,a as A,b as L,c as O}from"./DialogTitle-dKimb_-J.js";import{F as j,I as p,S as m,T as C}from"./TextField-B5TSfn_l.js";import{S as te}from"./Snackbar-DrVTsFTV.js";import{A as ae}from"./Alert-BPajDfgF.js";const re=S(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),le=S(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),ne=S(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),ie={معلق:"warning",موافق:"success",مرفوض:"error"},oe={"رصيد سبت":"primary","رصيد جمعة":"info",مرضية:"error",سنوية:"warning",طارئة:"secondary"};function ye({leaves:D,employees:T,pendingCount:I,currentStatus:q}){const[B,c]=x.useState(!1),[F,u]=x.useState(!1),[M,H]=x.useState(q||"معلق"),[d,n]=x.useState({open:!1,message:"",severity:"success"}),a=_({employee_id:"",leave_date:new Date().toISOString().split("T")[0],type:"سنوية",notes:""}),r=_({employee_id:"",return_date:new Date().toISOString().split("T")[0],return_type:"مناوبة"}),R=(s,f)=>{H(f),v.get("/leaves",{status:f==="الكل"?"":f},{preserveState:!0})},E=s=>{s.preventDefault(),a.post("/leaves",{onSuccess:()=>{c(!1),a.reset(),n({open:!0,message:"تم تقديم طلب الإجازة بنجاح",severity:"success"})},onError:()=>{n({open:!0,message:"حدث خطأ",severity:"error"})}})},P=s=>{s.preventDefault(),r.post("/leaves/return",{onSuccess:()=>{u(!1),r.reset(),n({open:!0,message:"تم تسجيل العودة بنجاح",severity:"success"})},onError:()=>{n({open:!0,message:"حدث خطأ",severity:"error"})}})},$=s=>{v.post(`/leaves/${s.id}/approve`,{},{onSuccess:()=>{n({open:!0,message:"تمت الموافقة على الطلب",severity:"success"})}})},V=s=>{v.post(`/leaves/${s.id}/reject`,{},{onSuccess:()=>{n({open:!0,message:"تم رفض الطلب",severity:"success"})}})};return e.jsxs(J,{title:"الإجازات",children:[e.jsx(G,{title:"الإجازات"}),e.jsxs(i,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsx(g,{variant:"h5",fontWeight:600,children:"سجل الإجازات"}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(o,{variant:"outlined",onClick:()=>u(!0),children:"تسجيل عودة"}),e.jsx(o,{variant:"contained",startIcon:e.jsx(re,{}),onClick:()=>c(!0),children:"طلب إجازة"})]})]}),e.jsx(i,{sx:{mb:2},children:e.jsxs(X,{value:M,onChange:R,children:[e.jsx(h,{label:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:["معلقة",I>0&&e.jsx(b,{label:I,size:"small",color:"warning"})]}),value:"معلق"}),e.jsx(h,{label:"موافق عليها",value:"موافق"}),e.jsx(h,{label:"مرفوضة",value:"مرفوض"}),e.jsx(h,{label:"الكل",value:"الكل"})]})}),e.jsx(N,{children:e.jsx(Q,{children:e.jsx(Y,{component:U,elevation:0,children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(y,{children:[e.jsx(t,{children:"الموظف"}),e.jsx(t,{children:"تاريخ الإجازة"}),e.jsx(t,{children:"النوع"}),e.jsx(t,{children:"الحالة"}),e.jsx(t,{children:"تاريخ الطلب"}),e.jsx(t,{children:"الإجراءات"})]})}),e.jsxs(se,{children:[D.map(s=>e.jsxs(y,{hover:!0,children:[e.jsx(t,{children:e.jsx(g,{fontWeight:500,children:s.employee?.name})}),e.jsx(t,{children:k(s.leave_date)}),e.jsx(t,{children:e.jsx(b,{label:s.type,color:oe[s.type],size:"small",variant:"outlined"})}),e.jsx(t,{children:e.jsx(b,{label:s.status,color:ie[s.status],size:"small"})}),e.jsx(t,{children:k(s.created_at)}),e.jsx(t,{children:s.status==="معلق"&&e.jsxs(i,{sx:{display:"flex",gap:.5},children:[e.jsx(W,{title:"موافقة",children:e.jsx(z,{size:"small",color:"success",onClick:()=>$(s),children:e.jsx(le,{fontSize:"small"})})}),e.jsx(W,{title:"رفض",children:e.jsx(z,{size:"small",color:"error",onClick:()=>V(s),children:e.jsx(ne,{fontSize:"small"})})})]})})]},s.id)),D.length===0&&e.jsx(y,{children:e.jsx(t,{colSpan:6,align:"center",children:e.jsxs(i,{sx:{py:4},children:[e.jsx(K,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(g,{color:"text.secondary",children:"لا توجد طلبات إجازة"})]})})})]})]})})})}),e.jsx(w,{open:B,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:e.jsxs("form",{onSubmit:E,children:[e.jsx(A,{children:"طلب إجازة جديدة"}),e.jsx(L,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[e.jsxs(j,{fullWidth:!0,required:!0,children:[e.jsx(p,{children:"الموظف"}),e.jsx(m,{value:a.data.employee_id,label:"الموظف",onChange:s=>a.setData("employee_id",s.target.value),children:T.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))})]}),e.jsx(C,{type:"date",label:"تاريخ الإجازة",value:a.data.leave_date,onChange:s=>a.setData("leave_date",s.target.value),fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}}),e.jsxs(j,{fullWidth:!0,required:!0,children:[e.jsx(p,{children:"نوع الإجازة"}),e.jsxs(m,{value:a.data.type,label:"نوع الإجازة",onChange:s=>a.setData("type",s.target.value),children:[e.jsx(l,{value:"رصيد سبت",children:"من رصيد السبت"}),e.jsx(l,{value:"رصيد جمعة",children:"من رصيد الجمعة"}),e.jsx(l,{value:"مرضية",children:"إجازة مرضية"}),e.jsx(l,{value:"سنوية",children:"إجازة سنوية"}),e.jsx(l,{value:"طارئة",children:"إجازة طارئة"})]})]}),e.jsx(C,{label:"ملاحظات",value:a.data.notes,onChange:s=>a.setData("notes",s.target.value),fullWidth:!0,multiline:!0,rows:3})]})}),e.jsxs(O,{children:[e.jsx(o,{onClick:()=>c(!1),children:"إلغاء"}),e.jsx(o,{type:"submit",variant:"contained",disabled:a.processing,children:"تقديم الطلب"})]})]})}),e.jsx(w,{open:F,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:e.jsxs("form",{onSubmit:P,children:[e.jsx(A,{children:"تسجيل عودة من إجازة"}),e.jsx(L,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[e.jsxs(j,{fullWidth:!0,required:!0,children:[e.jsx(p,{children:"الموظف"}),e.jsx(m,{value:r.data.employee_id,label:"الموظف",onChange:s=>r.setData("employee_id",s.target.value),children:T.filter(s=>s.status!=="متاح").map(s=>e.jsxs(l,{value:s.id,children:[s.name," - ",s.status]},s.id))})]}),e.jsx(C,{type:"date",label:"تاريخ العودة",value:r.data.return_date,onChange:s=>r.setData("return_date",s.target.value),fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}}),e.jsxs(j,{fullWidth:!0,required:!0,children:[e.jsx(p,{children:"نوع العودة"}),e.jsxs(m,{value:r.data.return_type,label:"نوع العودة",onChange:s=>r.setData("return_type",s.target.value),children:[e.jsx(l,{value:"مناوبة",children:"عودة من إجازة مناوبة (حسب الترتيب)"}),e.jsx(l,{value:"سنوية",children:"عودة من إجازة سنوية (أولوية)"})]})]})]})}),e.jsxs(O,{children:[e.jsx(o,{onClick:()=>u(!1),children:"إلغاء"}),e.jsx(o,{type:"submit",variant:"contained",disabled:r.processing,children:"تسجيل العودة"})]})]})}),e.jsx(te,{open:d.open,autoHideDuration:4e3,onClose:()=>n({...d,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsx(ae,{severity:d.severity,onClose:()=>n({...d,open:!1}),children:d.message})})]})}export{ye as default};
