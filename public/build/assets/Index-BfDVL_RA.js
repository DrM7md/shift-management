import{j as e,r as a,H as I,d as y}from"./app-Cwhk-y-Q.js";import{M as _,W as A}from"./MainLayout-DG_h4u18.js";import{f as m}from"./dateFormat-TyM5950g.js";import{G as l}from"./Grid-ClWOtsL_.js";import{b as O,C as c,d,T as n,B as C,P as E}from"./Schedule-DiIcUQZb.js";import{C as H,W as M}from"./Warning-BabsieMG.js";import{B as x}from"./Button-bpof-n8Y.js";import{T as U,a as L,b as P,c as p,d as r,e as G}from"./TableRow-UwqfMSIv.js";import{C as v}from"./Chip-DMEJQ661.js";import{D as R,a as F,b as $,c as q}from"./DialogTitle-dKimb_-J.js";import{T as J}from"./TextField-B5TSfn_l.js";import{S as K}from"./Snackbar-DrVTsFTV.js";import{A as N}from"./Alert-BPajDfgF.js";const Q=O(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),V={متاح:"success",مستخدم:"warning",منتهي:"error"};function de({balances:u,stats:h}){const[S,o]=a.useState(!1),[j,b]=a.useState(null),[g,D]=a.useState(new Date().toISOString().split("T")[0]),[t,i]=a.useState({open:!1,message:"",severity:"success"}),T=s=>{b(s),o(!0)},z=()=>{j&&y.post(`/balances/${j.id}/use`,{used_date:g},{onSuccess:()=>{o(!1),i({open:!0,message:"تم استخدام الرصيد بنجاح",severity:"success"})},onError:()=>{i({open:!0,message:"حدث خطأ",severity:"error"})}})},k=()=>{y.post("/balances/expire-old",{},{onSuccess:()=>{i({open:!0,message:"تم تحديث الأرصدة المنتهية",severity:"success"})}})},w=s=>{const W=new Date(s.expiry_date),B=new Date,f=Math.ceil((W.getTime()-B.getTime())/(1e3*60*60*24));return f<=3&&f>=0&&s.status==="متاح"};return e.jsxs(_,{title:"الأرصدة",children:[e.jsx(I,{title:"الأرصدة"}),e.jsxs(l,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(c,{children:e.jsxs(d,{sx:{textAlign:"center"},children:[e.jsx(H,{sx:{fontSize:40,color:"success.main",mb:1}}),e.jsx(n,{variant:"h3",fontWeight:700,color:"success.main",children:h.available}),e.jsx(n,{color:"text.secondary",children:"أرصدة متاحة"})]})})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(c,{children:e.jsxs(d,{sx:{textAlign:"center"},children:[e.jsx(M,{sx:{fontSize:40,color:"warning.main",mb:1}}),e.jsx(n,{variant:"h3",fontWeight:700,color:"warning.main",children:h.expiring}),e.jsx(n,{color:"text.secondary",children:"قريبة من الانتهاء"})]})})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(c,{children:e.jsxs(d,{sx:{textAlign:"center"},children:[e.jsx(Q,{sx:{fontSize:40,color:"error.main",mb:1}}),e.jsx(n,{variant:"h3",fontWeight:700,color:"error.main",children:h.expired}),e.jsx(n,{color:"text.secondary",children:"منتهية"})]})})})]}),e.jsx(C,{sx:{mb:2},children:e.jsx(x,{variant:"outlined",color:"warning",onClick:k,children:"تحديث الأرصدة المنتهية"})}),e.jsx(c,{children:e.jsx(d,{children:e.jsx(U,{component:E,elevation:0,children:e.jsxs(L,{children:[e.jsx(P,{children:e.jsxs(p,{children:[e.jsx(r,{children:"الموظف"}),e.jsx(r,{children:"تاريخ الاكتساب"}),e.jsx(r,{children:"تاريخ الانتهاء"}),e.jsx(r,{children:"النوع"}),e.jsx(r,{children:"الحالة"}),e.jsx(r,{children:"تاريخ الاستخدام"}),e.jsx(r,{children:"الإجراءات"})]})}),e.jsxs(G,{children:[u.map(s=>e.jsxs(p,{hover:!0,sx:w(s)?{bgcolor:"warning.dark","&:hover":{bgcolor:"warning.main"}}:{},children:[e.jsx(r,{children:e.jsx(n,{fontWeight:500,children:s.employee?.name})}),e.jsx(r,{children:m(s.earned_date)}),e.jsx(r,{children:m(s.expiry_date)}),e.jsx(r,{children:e.jsx(v,{label:s.type,size:"small",color:"primary",variant:"outlined"})}),e.jsx(r,{children:e.jsx(v,{label:s.status,color:V[s.status],size:"small"})}),e.jsx(r,{children:s.used_date?m(s.used_date):"-"}),e.jsx(r,{children:s.status==="متاح"&&e.jsx(x,{size:"small",variant:"outlined",onClick:()=>T(s),children:"استخدام"})})]},s.id)),u.length===0&&e.jsx(p,{children:e.jsx(r,{colSpan:7,align:"center",children:e.jsxs(C,{sx:{py:4},children:[e.jsx(A,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(n,{color:"text.secondary",children:"لا توجد أرصدة"})]})})})]})]})})})}),e.jsxs(R,{open:S,onClose:()=>o(!1),children:[e.jsx(F,{children:"استخدام الرصيد"}),e.jsxs($,{children:[e.jsxs(n,{sx:{mb:2},children:["الموظف: ",j?.employee?.name]}),e.jsx(J,{type:"date",label:"تاريخ الاستخدام",value:g,onChange:s=>D(s.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})]}),e.jsxs(q,{children:[e.jsx(x,{onClick:()=>o(!1),children:"إلغاء"}),e.jsx(x,{onClick:z,variant:"contained",children:"تأكيد"})]})]}),e.jsx(K,{open:t.open,autoHideDuration:4e3,onClose:()=>i({...t,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsx(N,{severity:t.severity,onClose:()=>i({...t,open:!1}),children:t.message})})]})}export{de as default};
