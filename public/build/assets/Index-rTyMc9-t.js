import{j as e,r as i,u as X,H as pe,d as Y}from"./app-Cwhk-y-Q.js";import{M as fe,T as $,a as O,L as ge,b as ye,D as ve,A as be}from"./MainLayout-DG_h4u18.js";import{f as A}from"./dateFormat-TyM5950g.js";import{b as _,B as h,C as Ce,d as De,P as V,T as j,I as v,L as Se}from"./Schedule-DiIcUQZb.js";import{T as u,F as Ie,I as _e,S as ze}from"./TextField-B5TSfn_l.js";import{I as Te,V as Le}from"./Visibility-CK0CwFZ_.js";import{B as o}from"./Button-bpof-n8Y.js";import{T as R,a as P,b as M,c as d,d as r,e as B}from"./TableRow-UwqfMSIv.js";import{C as b}from"./Chip-DMEJQ661.js";import{E as We,D as ke}from"./Edit-2gKizbpp.js";import{D as C,a as D,b as S,c as I}from"./DialogTitle-dKimb_-J.js";import{G as f}from"./Grid-ClWOtsL_.js";import{T as we,a as G}from"./Tabs-Bq9LOEjY.js";import{A as Z}from"./Alert-BPajDfgF.js";import{S as Ee}from"./Snackbar-DrVTsFTV.js";const Oe=_(e.jsx("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"})),Ae=_(e.jsx("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"})),Ve=_(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),Re=_(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"})),ee=_(e.jsx("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"})),Pe={متاح:"success","إجازة مرضية":"error","إجازة سنوية":"warning","غير متاح":"default"};function es({employees:z}){const[F,se]=i.useState(""),[re,T]=i.useState(!1),[ae,L]=i.useState(!1),[le,W]=i.useState(!1),[te,k]=i.useState(!1),[ne,H]=i.useState(!1),[m,w]=i.useState(null),[x,q]=i.useState(null),[E,ie]=i.useState(0),[g,c]=i.useState({open:!1,message:"",severity:"success"}),[y,U]=i.useState([]),[J,oe]=i.useState("saturday"),t=X({name:"",email:"",saturday_order:z.length+1,thursday_order:z.length+1}),l=X({name:"",email:"",status:"متاح",saturday_order:1,thursday_order:1}),K=z.filter(s=>s.name.toLowerCase().includes(F.toLowerCase())||s.email.toLowerCase().includes(F.toLowerCase())),de=s=>{s.preventDefault(),t.post("/employees",{onSuccess:()=>{T(!1),t.reset(),c({open:!0,message:"تم إضافة الموظف بنجاح",severity:"success"})},onError:()=>{c({open:!0,message:"حدث خطأ أثناء إضافة الموظف",severity:"error"})}})},ce=s=>{w(s),l.setData({name:s.name,email:s.email,status:s.status,saturday_order:s.saturday_order,thursday_order:s.thursday_order}),L(!0)},he=s=>{s.preventDefault(),m&&l.put(`/employees/${m.id}`,{onSuccess:()=>{L(!1),c({open:!0,message:"تم تحديث بيانات الموظف بنجاح",severity:"success"})},onError:()=>{c({open:!0,message:"حدث خطأ أثناء تحديث الموظف",severity:"error"})}})},xe=s=>{w(s),W(!0)},je=()=>{m&&Y.delete(`/employees/${m.id}`,{onSuccess:()=>{W(!1),w(null),c({open:!0,message:"تم حذف الموظف بنجاح",severity:"success"})},onError:()=>{c({open:!0,message:"حدث خطأ أثناء الحذف",severity:"error"})}})},ue=async s=>{w(s),H(!0);try{const n=await(await fetch(`/employees/${s.id}/details`)).json();q(n)}catch(a){console.error("Error fetching employee details:",a)}},N=s=>{oe(s);const a=[...z].sort((n,p)=>s==="saturday"?n.saturday_order-p.saturday_order:n.thursday_order-p.thursday_order);U(a),k(!0)},Q=(s,a)=>{const n=[...y],p=a==="up"?s-1:s+1;p<0||p>=n.length||([n[s],n[p]]=[n[p],n[s]],U(n))},me=()=>{const s=y.map((a,n)=>({id:a.id,order:n+1}));Y.post("/employees/reorder",{type:J,orders:s},{onSuccess:()=>{k(!1),c({open:!0,message:"تم حفظ الترتيب بنجاح",severity:"success"})},onError:()=>{c({open:!0,message:"حدث خطأ أثناء حفظ الترتيب",severity:"error"})}})};return e.jsxs(fe,{title:"الموظفين",children:[e.jsx(pe,{title:"الموظفين"}),e.jsxs(h,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsx(u,{placeholder:"بحث عن موظف...",value:F,onChange:s=>se(s.target.value),size:"small",sx:{minWidth:300},InputProps:{startAdornment:e.jsx(Te,{position:"start",children:e.jsx(Re,{})})}}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[e.jsx(o,{variant:"outlined",startIcon:e.jsx(ee,{}),onClick:()=>N("saturday"),children:"ترتيب السبت"}),e.jsx(o,{variant:"outlined",startIcon:e.jsx(ee,{}),onClick:()=>N("thursday"),children:"ترتيب الخميس"}),e.jsx(o,{variant:"contained",startIcon:e.jsx(Ve,{}),onClick:()=>T(!0),children:"إضافة موظف"})]})]}),e.jsx(Ce,{children:e.jsx(De,{children:e.jsx(R,{component:V,elevation:0,children:e.jsxs(P,{children:[e.jsx(M,{children:e.jsxs(d,{children:[e.jsx(r,{children:"#"}),e.jsx(r,{children:"الاسم"}),e.jsx(r,{children:"البريد"}),e.jsx(r,{children:"الحالة"}),e.jsx(r,{children:"ترتيب السبت"}),e.jsx(r,{children:"ترتيب الخميس"}),e.jsx(r,{children:"الإجراءات"})]})}),e.jsxs(B,{children:[K.map((s,a)=>e.jsxs(d,{hover:!0,children:[e.jsx(r,{children:a+1}),e.jsx(r,{children:e.jsx(j,{fontWeight:500,children:s.name})}),e.jsx(r,{children:s.email}),e.jsx(r,{children:e.jsx(b,{label:s.status,color:Pe[s.status],size:"small"})}),e.jsx(r,{children:s.saturday_order}),e.jsx(r,{children:s.thursday_order}),e.jsx(r,{children:e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx($,{title:"عرض التفاصيل",children:e.jsx(v,{size:"small",color:"info",onClick:()=>ue(s),children:e.jsx(Le,{fontSize:"small"})})}),e.jsx($,{title:"تعديل",children:e.jsx(v,{size:"small",color:"primary",onClick:()=>ce(s),children:e.jsx(We,{fontSize:"small"})})}),e.jsx($,{title:"حذف",children:e.jsx(v,{size:"small",color:"error",onClick:()=>xe(s),children:e.jsx(ke,{fontSize:"small"})})})]})})]},s.id)),K.length===0&&e.jsx(d,{children:e.jsx(r,{colSpan:7,align:"center",children:e.jsx(j,{color:"text.secondary",sx:{py:3},children:"لا يوجد موظفين"})})})]})]})})})}),e.jsx(C,{open:re,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,children:e.jsxs("form",{onSubmit:de,children:[e.jsx(D,{children:"إضافة موظف جديد"}),e.jsx(S,{children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[e.jsx(u,{label:"اسم الموظف",value:t.data.name,onChange:s=>t.setData("name",s.target.value),error:!!t.errors.name,helperText:t.errors.name,fullWidth:!0,required:!0}),e.jsx(u,{label:"البريد الإلكتروني",type:"email",value:t.data.email,onChange:s=>t.setData("email",s.target.value),error:!!t.errors.email,helperText:t.errors.email,fullWidth:!0,required:!0}),e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{size:6,children:e.jsx(u,{label:"ترتيب السبت",type:"number",value:t.data.saturday_order,onChange:s=>t.setData("saturday_order",parseInt(s.target.value)),fullWidth:!0,inputProps:{min:1}})}),e.jsx(f,{size:6,children:e.jsx(u,{label:"ترتيب الخميس",type:"number",value:t.data.thursday_order,onChange:s=>t.setData("thursday_order",parseInt(s.target.value)),fullWidth:!0,inputProps:{min:1}})})]})]})}),e.jsxs(I,{children:[e.jsx(o,{onClick:()=>T(!1),children:"إلغاء"}),e.jsx(o,{type:"submit",variant:"contained",disabled:t.processing,children:"إضافة"})]})]})}),e.jsx(C,{open:ae,onClose:()=>L(!1),maxWidth:"sm",fullWidth:!0,children:e.jsxs("form",{onSubmit:he,children:[e.jsx(D,{children:"تعديل بيانات الموظف"}),e.jsx(S,{children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[e.jsx(u,{label:"اسم الموظف",value:l.data.name,onChange:s=>l.setData("name",s.target.value),error:!!l.errors.name,helperText:l.errors.name,fullWidth:!0,required:!0}),e.jsx(u,{label:"البريد الإلكتروني",type:"email",value:l.data.email,onChange:s=>l.setData("email",s.target.value),error:!!l.errors.email,helperText:l.errors.email,fullWidth:!0,required:!0}),e.jsxs(Ie,{fullWidth:!0,children:[e.jsx(_e,{children:"الحالة"}),e.jsxs(ze,{value:l.data.status,label:"الحالة",onChange:s=>l.setData("status",s.target.value),children:[e.jsx(O,{value:"متاح",children:"متاح"}),e.jsx(O,{value:"إجازة مرضية",children:"إجازة مرضية"}),e.jsx(O,{value:"إجازة سنوية",children:"إجازة سنوية"}),e.jsx(O,{value:"غير متاح",children:"غير متاح"})]})]}),e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{size:6,children:e.jsx(u,{label:"ترتيب السبت",type:"number",value:l.data.saturday_order,onChange:s=>l.setData("saturday_order",parseInt(s.target.value)),fullWidth:!0,inputProps:{min:1}})}),e.jsx(f,{size:6,children:e.jsx(u,{label:"ترتيب الخميس",type:"number",value:l.data.thursday_order,onChange:s=>l.setData("thursday_order",parseInt(s.target.value)),fullWidth:!0,inputProps:{min:1}})})]})]})}),e.jsxs(I,{children:[e.jsx(o,{onClick:()=>L(!1),children:"إلغاء"}),e.jsx(o,{type:"submit",variant:"contained",disabled:l.processing,children:"حفظ التغييرات"})]})]})}),e.jsxs(C,{open:te,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(D,{children:["ترتيب مناوبات ",J==="saturday"?"السبت":"الخميس"]}),e.jsxs(S,{children:[e.jsx(j,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"استخدم الأسهم لتغيير ترتيب الموظفين في دورة المناوبات"}),e.jsx(Se,{sx:{bgcolor:"background.paper",borderRadius:2,border:1,borderColor:"divider"},children:y.map((s,a)=>e.jsxs(h,{children:[e.jsx(ge,{secondaryAction:e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(v,{size:"small",onClick:()=>Q(a,"up"),disabled:a===0,children:e.jsx(Ae,{fontSize:"small"})}),e.jsx(v,{size:"small",onClick:()=>Q(a,"down"),disabled:a===y.length-1,children:e.jsx(Oe,{fontSize:"small"})})]}),children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{label:a+1,size:"small",color:"primary"}),e.jsx(ye,{primary:s.name})]})}),a<y.length-1&&e.jsx(ve,{})]},s.id))})]}),e.jsxs(I,{children:[e.jsx(o,{onClick:()=>k(!1),children:"إلغاء"}),e.jsx(o,{onClick:me,variant:"contained",children:"حفظ الترتيب"})]})]}),e.jsxs(C,{open:ne,onClose:()=>{H(!1),q(null)},maxWidth:"md",fullWidth:!0,children:[e.jsx(D,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(be,{sx:{bgcolor:"primary.main"},children:m?.name.charAt(0)}),e.jsxs(h,{children:[e.jsx(j,{variant:"h6",children:m?.name}),e.jsx(j,{variant:"body2",color:"text.secondary",children:m?.email})]})]})}),e.jsxs(S,{children:[e.jsxs(we,{value:E,onChange:(s,a)=>ie(a),sx:{mb:2},children:[e.jsx(G,{label:"المناوبات"}),e.jsx(G,{label:"الأرصدة"}),e.jsx(G,{label:"الإجازات"})]}),E===0&&e.jsx(R,{component:V,elevation:0,children:e.jsxs(P,{size:"small",children:[e.jsx(M,{children:e.jsxs(d,{children:[e.jsx(r,{children:"التاريخ"}),e.jsx(r,{children:"اليوم"}),e.jsx(r,{children:"الحالة"}),e.jsx(r,{children:"يوم إضافي"})]})}),e.jsxs(B,{children:[x?.shifts?.map(s=>e.jsxs(d,{children:[e.jsx(r,{children:A(s.shift_date)}),e.jsx(r,{children:s.day_name}),e.jsx(r,{children:e.jsx(b,{label:s.status,size:"small"})}),e.jsx(r,{children:s.has_extra_day?"نعم":"لا"})]},s.id)),(!x?.shifts||x.shifts.length===0)&&e.jsx(d,{children:e.jsx(r,{colSpan:4,align:"center",children:e.jsx(j,{color:"text.secondary",children:"لا توجد مناوبات"})})})]})]})}),E===1&&e.jsx(R,{component:V,elevation:0,children:e.jsxs(P,{size:"small",children:[e.jsx(M,{children:e.jsxs(d,{children:[e.jsx(r,{children:"تاريخ الاكتساب"}),e.jsx(r,{children:"تاريخ الانتهاء"}),e.jsx(r,{children:"النوع"}),e.jsx(r,{children:"الحالة"})]})}),e.jsxs(B,{children:[x?.balances?.map(s=>e.jsxs(d,{children:[e.jsx(r,{children:A(s.earned_date)}),e.jsx(r,{children:A(s.expiry_date)}),e.jsx(r,{children:s.type}),e.jsx(r,{children:e.jsx(b,{label:s.status,size:"small"})})]},s.id)),(!x?.balances||x.balances.length===0)&&e.jsx(d,{children:e.jsx(r,{colSpan:4,align:"center",children:e.jsx(j,{color:"text.secondary",children:"لا توجد أرصدة"})})})]})]})}),E===2&&e.jsx(R,{component:V,elevation:0,children:e.jsxs(P,{size:"small",children:[e.jsx(M,{children:e.jsxs(d,{children:[e.jsx(r,{children:"التاريخ"}),e.jsx(r,{children:"النوع"}),e.jsx(r,{children:"الحالة"}),e.jsx(r,{children:"السبب"})]})}),e.jsxs(B,{children:[x?.leaves?.map(s=>e.jsxs(d,{children:[e.jsx(r,{children:A(s.leave_date)}),e.jsx(r,{children:s.type}),e.jsx(r,{children:e.jsx(b,{label:s.status,size:"small"})}),e.jsx(r,{children:s.notes||"-"})]},s.id)),(!x?.leaves||x.leaves.length===0)&&e.jsx(d,{children:e.jsx(r,{colSpan:4,align:"center",children:e.jsx(j,{color:"text.secondary",children:"لا توجد إجازات"})})})]})]})})]}),e.jsx(I,{children:e.jsx(o,{onClick:()=>{H(!1),q(null)},children:"إغلاق"})})]}),e.jsxs(C,{open:le,onClose:()=>W(!1),children:[e.jsx(D,{children:"تأكيد الحذف"}),e.jsxs(S,{children:[e.jsxs(j,{children:['هل أنت متأكد من حذف الموظف "',m?.name,'"؟']}),e.jsx(Z,{severity:"warning",sx:{mt:2},children:"سيتم حذف جميع بيانات هذا الموظف بشكل نهائي"})]}),e.jsxs(I,{children:[e.jsx(o,{onClick:()=>W(!1),children:"إلغاء"}),e.jsx(o,{onClick:je,color:"error",variant:"contained",children:"تأكيد الحذف"})]})]}),e.jsx(Ee,{open:g.open,autoHideDuration:4e3,onClose:()=>c({...g,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsx(Z,{severity:g.severity,onClose:()=>c({...g,open:!1}),children:g.message})})]})}export{es as default};
